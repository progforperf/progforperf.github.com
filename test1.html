<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en" xml:lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="http://moodle.rrze.uni-erlangen.de/moodle/theme/standard/styles.php" />
<link rel="stylesheet" type="text/css" href="http://moodle.rrze.uni-erlangen.de/moodle/theme/standardwhite/styles.php" />

<!--[if IE 7]>
    <link rel="stylesheet" type="text/css" href="http://moodle.rrze.uni-erlangen.de/moodle/theme/standard/styles_ie7.css" />
<![endif]-->
<!--[if IE 6]>
    <link rel="stylesheet" type="text/css" href="http://moodle.rrze.uni-erlangen.de/moodle/theme/standard/styles_ie6.css" />
<![endif]-->


    <meta name="keywords" content="moodle, tut161: Exercise: Code optimization " />
    <title>tut161: Exercise: Code optimization</title>
    <link rel="shortcut icon" href="http://moodle.rrze.uni-erlangen.de/moodle/theme/standardwhite/favicon.ico" />
    <!--<style type="text/css">/*<![CDATA[*/ body{behavior:url(http://moodle.rrze.uni-erlangen.de/moodle/lib/csshover.htc);} /*]]>*/</style>-->

<script type="text/javascript" src="http://moodle.rrze.uni-erlangen.de/moodle/lib/javascript-static.js"></script>
<script type="text/javascript" src="http://moodle.rrze.uni-erlangen.de/moodle/lib/javascript-mod.php"></script>
<script type="text/javascript" src="http://moodle.rrze.uni-erlangen.de/moodle/lib/overlib/overlib.js"></script>
<script type="text/javascript" src="http://moodle.rrze.uni-erlangen.de/moodle/lib/overlib/overlib_cssstyle.js"></script>
<script type="text/javascript" src="http://moodle.rrze.uni-erlangen.de/moodle/lib/cookies.js"></script>
<script type="text/javascript" src="http://moodle.rrze.uni-erlangen.de/moodle/lib/ufo.js"></script>
<script type="text/javascript" src="http://moodle.rrze.uni-erlangen.de/moodle/lib/dropdown.js"></script>  

<script type="text/javascript" defer="defer">
//<![CDATA[
setTimeout('fix_column_widths()', 20);
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
function openpopup(url, name, options, fullscreen) {
    var fullurl = "http://moodle.rrze.uni-erlangen.de/moodle" + url;
    var windowobj = window.open(fullurl, name, options);
    if (!windowobj) {
        return true;
    }
    if (fullscreen) {
        windowobj.moveTo(0, 0);
        windowobj.resizeTo(screen.availWidth, screen.availHeight);
    }
    windowobj.focus();
    return false;
}

function uncheckall() {
    var inputs = document.getElementsByTagName('input');
    for(var i = 0; i < inputs.length; i++) {
        inputs[i].checked = false;
    }
}

function checkall() {
    var inputs = document.getElementsByTagName('input');
    for(var i = 0; i < inputs.length; i++) {
        inputs[i].checked = true;
    }
}

function inserttext(text) {
  text = ' ' + text + ' ';
  if ( opener.document.forms['theform'].message.createTextRange && opener.document.forms['theform'].message.caretPos) {
    var caretPos = opener.document.forms['theform'].message.caretPos;
    caretPos.text = caretPos.text.charAt(caretPos.text.length - 1) == ' ' ? text + ' ' : text;
  } else {
    opener.document.forms['theform'].message.value  += text;
  }
  opener.document.forms['theform'].message.focus();
}

function getElementsByClassName(oElm, strTagName, oClassNames){
  var arrElements = (strTagName == "*" && oElm.all)? oElm.all : oElm.getElementsByTagName(strTagName);
	var arrReturnElements = new Array();
	var arrRegExpClassNames = new Array();
	if(typeof oClassNames == "object"){
		for(var i=0; i<oClassNames.length; i++){
			arrRegExpClassNames.push(new RegExp("(^|\\s)" + oClassNames[i].replace(/\-/g, "\\-") + "(\\s|$)"));
		}
	}
	else{
		arrRegExpClassNames.push(new RegExp("(^|\\s)" + oClassNames.replace(/\-/g, "\\-") + "(\\s|$)"));
	}
	var oElement;
	var bMatchesAll;
	for(var j=0; j<arrElements.length; j++){
		oElement = arrElements[j];
		bMatchesAll = true;
		for(var k=0; k<arrRegExpClassNames.length; k++){
			if(!arrRegExpClassNames[k].test(oElement.className)){
				bMatchesAll = false;
				break;
			}
		}
		if(bMatchesAll){
			arrReturnElements.push(oElement);
		}
	}
	return (arrReturnElements)
}
//]]>
</script>
</head>

<body  class="mod-resource course-256 dir-ltr lang-en_utf8" id="mod-resource-view">

<div id="page">

    <div id="header" class=" clearfix">        <h1 class="headermain">SC12 Tutorial "The practitioner's cookbook for good parallel performance on multi- and manycore systems"</h1>
        <div class="headermenu"><div class="navigation">
<ul><li><form action="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php"  onclick="this.target='_top';"><fieldset class="invisiblefieldset"><input type="hidden" name="id" value="3953" /><button type="submit" title="Previous activity"><span class="arrow ">&#x25C4;</span><span class="accesshide " >&nbsp;Previous activity</span></button></fieldset></form></li><li><form action="http://moodle.rrze.uni-erlangen.de/moodle/course/jumpto.php" method="get"  id="navmenupopup" class="popupform"><div><select id="navmenupopup_jump" name="jump" onchange="self.location=document.getElementById('navmenupopup').jump.options[document.getElementById('navmenupopup').jump.selectedIndex].value;">
   <option value="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php?id=3950" style="background-image: url(http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/icon.gif);">Tutorial slides</option>
   <option value="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php?id=3427" style="background-image: url(http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/icon.gif);">Working with the Lima cluster at RRZE</option>
   <option value="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php?id=3948" style="background-image: url(http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/icon.gif);">Working with likwid-topology and likwid-pin</option>
   <option value="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php?id=3954" style="background-image: url(http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/icon.gif);">Using likwid-perfctr and frequency settings on Lima</option>
   <option value="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php?id=3956" style="background-image: url(http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/icon.gif);">Example code for download</option>
   <option value="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php?id=3957" style="background-image: url(http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/icon.gif);">Download the current version of the LIKWID suite (...</option>
   <optgroup label="Important: You will find simple example codes toge...">   <option value="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php?id=3870" style="background-image: url(http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/icon.gif);">Exercise: Probing memory bandwidth with the STREAM...</option>
   </optgroup>   <optgroup label="Topic 2">   <option value="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php?id=3953" style="background-image: url(http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/icon.gif);">Exercise: A 3D Jacobi code</option>
   </optgroup>   <optgroup label="Topic 3">   <option value="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/view.php?id=3955" selected="selected" style="background-image: url(http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/icon.gif);">Jump to...</option>
    </optgroup></select><input type="hidden" name="sesskey" value="bYzUWtk040" /><div id="noscriptnavmenupopup" style="display: inline;"><input type="submit" value="Go" /></div><script type="text/javascript">
//<![CDATA[
document.getElementById("noscriptnavmenupopup").style.display = "none";
//]]>
</script></div></form></li></ul>
</div></div>
    </div>    <div class="navbar clearfix">
        <div class="breadcrumb"><h2 class="accesshide " >You are here</h2> <ul>
<li class="first"><a  onclick="this.target='_top'" href="http://moodle.rrze.uni-erlangen.de/moodle/">RRZE</a></li><li> <span class="accesshide " >/&nbsp;</span><span class="arrow sep">&#x25BA;</span> <a  onclick="this.target='_top'" href="http://moodle.rrze.uni-erlangen.de/moodle/course/view.php?id=256">tut161</a></li><li> <span class="accesshide " >/&nbsp;</span><span class="arrow sep">&#x25BA;</span> <a  onclick="this.target='_top'" href="http://moodle.rrze.uni-erlangen.de/moodle/mod/resource/index.php?id=256">Resources</a></li><li> <span class="accesshide " >/&nbsp;</span><span class="arrow sep">&#x25BA;</span> Exercise: Code optimization</li></ul></div>
        <div class="navbutton">&nbsp;</div>
    </div>
    <!-- END OF HEADER -->
    <div id="content" class=" clearfix"><div class="box generalbox generalboxcontent boxaligncenter clearfix">
<div class="box generalbox generalboxcontent boxaligncenter clearfix"><span style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);">Which optimization strategies would you suggest for the piece of code below? The code is contained in the <b><font face="courier new,courier,monospace">OPT/</font></b> subfolder, in F90 and C versions. You can build it with<br /><br /></span>
  <p style="text-indent: 0in; background-color: rgb(250, 250, 250); margin-top: 0pt; margin-bottom: 0pt; margin-left: 0in; direction: ltr; unicode-bidi: embed;"><font size="4" face="courier new,courier,monospace"><b><span style="vertical-align: baseline;">$ make <font size="4">OPT</font>_F.exe # Fortran build</span></b></font></p>
  <p style="text-indent: 0in; background-color: rgb(250, 250, 250); margin-top: 0pt; margin-bottom: 0pt; margin-left: 0in; direction: ltr; unicode-bidi: embed;"><font size="4" face="courier new,courier,monospace"><b><span style="vertical-align: baseline;">$ </span><span style="vertical-align: baseline;">make <font size="4">OPT</font>_C.exe # C build</span></b></font></p>
  <p style="font-size: 16px; text-indent: 0in; font-family: arial,verdana,helvetica,sans-serif; background-color: rgb(250, 250, 250); margin-top: 0pt; margin-bottom: 0pt; margin-left: 0in; direction: ltr; unicode-bidi: embed;"><span style="vertical-align: baseline;"><br /></span></p><span style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);">Write down what you expect to give the best performance. You may test your work by performing benchmark runs.</span><br style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);" /><br style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);" /><hr style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250); width: 1489.45px; height: 2px;" /><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">double mat[N][N], s[N][N], val;</span><br style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;" /><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">int i, j, v[N];</span><br style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;" /><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">//</span><br style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;" /><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">// ... v[] and s[][] may be assumed to contain valid data</span><br style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;" /><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">//</span><br style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;" /><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">for(i=0; i&lt;N ; ++i) {</span><br style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;" /><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); color: rgb(255, 255, 255); font-family: 'courier new',courier,monospace;"></span><span style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);"></span>
  <div style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250); margin-left: 40px;"><span style="font-family: 'courier new',courier,monospace;">for(j=0; j&lt;N; ++j) {</span><br style="font-family: 'courier new',courier,monospace;" />
    <div style="margin-left: 40px;"><span style="color: rgb(255, 255, 255); font-family: 'courier new',courier,monospace;"></span><span style="font-family: 'courier new',courier,monospace;">val = (double)(v[i] % 256);</span><br style="font-family: 'courier new',courier,monospace;" /><span style="color: rgb(255, 255, 255); font-family: 'courier new',courier,monospace;"></span><span style="font-family: 'courier new',courier,monospace;">mat[j][i] = s[j][i]*(sin(val)*sin(val)-cos(val)*cos(val));</span><span style="color: rgb(255, 255, 255); font-family: 'courier new',courier,monospace;"></span><br /></div><span style="color: rgb(255, 255, 255); font-family: 'courier new',courier,monospace;"></span><span style="font-family: 'courier new',courier,monospace;">}</span><br style="font-family: 'courier new',courier,monospace;" /></div><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">}</span><br style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);" /><hr style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250); width: 1489.45px; height: 2px;" /><br style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);" /><span style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);">No assumptions about the size of </span><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">N</span><span style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);"> may be made. You may, however, assume that the code is part of a function that gets called very frequently. </span><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">s[][]</span><span style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);"> and </span><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">v[]</span><span style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);"> may change between calls, and all entries of </span><span style="font-size: 16.3636px; background-color: rgb(250, 250, 250); font-family: 'courier new',courier,monospace;">v[]</span><span style="font-family: arial,verdana,helvetica,sans-serif; font-size: 16.3636px; background-color: rgb(250, 250, 250);"> are positive.<br /><br /></span>Can you develop a performance model for your optimized code? What is the code balance for large N? What is the latency for evaluating the <font face="courier new,courier,monospace"><b>cos()</b></font> function?<br /><br /> </div> </div><div class="modified">Last modified: Friday, 9 November 2012, 02:49 PM</div></div><div id="footer"><hr /><p class="helplink"></p><div class="logininfo">You are currently using guest access (<a  href="http://moodle.rrze.uni-erlangen.de/moodle/login/index.php">Login</a>)</div><div class="homelink"><a  href="http://moodle.rrze.uni-erlangen.de/moodle/course/view.php?id=256">tut161</a></div></div>
</div>
</body>
</html>
